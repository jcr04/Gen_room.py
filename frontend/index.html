<!DOCTYPE html>
<html>

<head>
    <title>Gerenciamento de Recursos e Salas</title>
</head>

<body>
    <h1>Gerenciamento de Recursos e Salas</h1>
    <h2>Criar uma nova sala:</h2>
    <form id="createRoomForm">
        <label for="roomName">Nome da Sala:</label>
        <input type="text" id="roomName" required>
        <br>
        <label for="roomType">Tipo da Sala:</label>
        <input type="text" id="roomType" required>
        <br>
        <label for="roomCapacity">Capacidade:</label>
        <input type="number" id="roomCapacity" required>
        <br>
        <label for="roomDescription">Descrição:</label>
        <input type="text" id="roomDescription" required>
        <br>
        <label for="roomCategory">Categoria:</label>
        <input type="text" id="roomCategory" required>
        <br>
        <button type="submit">Criar Sala</button>
    </form>

    <!-- Seção para visualizar a resposta da requisição GET -->
    <h2>Salas Disponíveis:</h2>
    <div id="roomList"></div>
    <button id="getRoomsButton">Buscar Salas</button>

    <script>
        const roomDescription = document.getElementById('roomDescription').value;
        const roomCategory = document.getElementById('roomCategory').value;

        createRoomForm.addEventListener('submit', function (event) {
            event.preventDefault(); // Evita o comportamento padrão de envio do formulário


            const roomName = document.getElementById('roomName').value;
            const roomType = document.getElementById('roomType').value;
            const roomCapacity = document.getElementById('roomCapacity').value;
            const roomDescription = document.getElementById('roomDescription').value;
            const roomCategory = document.getElementById('roomCategory').value;

            // Monta os dados em um objeto JSON
            const formData = {
                name: roomName,
                room_type: roomType,
                capacity: parseInt(roomCapacity), // Converte para número inteiro
                description: roomDescription,
                room_category: roomCategory
            };

            // Envia uma solicitação POST para o backend (Flask)
            fetch('http://localhost:5001/api/rooms', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => {
                    // Verifica se a criação foi bem-sucedida
                    if (data.error) {
                        alert('Erro ao criar a sala: ' + data.error);
                    } else {
                        alert('Sala criada com sucesso!');
                        // Limpa os campos do formulário
                        createRoomForm.reset();
                    }
                })
                .catch(error => {
                    console.error('Erro ao enviar a solicitação:', error);
                    alert('Erro ao criar a sala. Verifique o console para mais detalhes.');
                });
        });

        // Função para buscar e exibir a lista de salas
        function getRooms() {
            fetch('http://localhost:5001/api/rooms', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Erro ao buscar salas:', data.error);
                    } else {
                        // Limpa a lista de salas
                        roomList.innerHTML = '';

                        if (Array.isArray(data.rooms)) {
                            data.rooms.forEach(room => {
                                const roomItem = document.createElement('div');
                                roomItem.innerHTML = `
                          <h3>${room.name}</h3>
                          <p>Tipo: ${room.room_type}</p>
                          <p>Capacidade: ${room.capacity}</p>
                          <p>Descrição: ${room.description}</p>
                          <p>Categoria: ${room.room_category}</p>
                        `;
                                roomList.appendChild(roomItem);
                            });
                        } else {
                            console.error('Erro ao buscar salas: Dados inválidos recebidos');
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar salas:', error);
                });
        }
            // Chama a função para buscar e exibir a lista de salas quando a página carrega
            window.addEventListener('load', getRooms)

            const getRoomsButton = document.getElementById('getRoomsButton');
            getRoomsButton.addEventListener('click', getRooms);
    </script>
</body>

</html>